<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/developer-notes.md at 08-februari-2022
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>BRMO 2.2.1 &#x2013; Developer notes</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>

  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://www.b3partners.nl/" id="bannerLeft"><img src="images/logo.png"  alt="B3Partners B.V."/></a></div>
          <div class="pull-right"><a href="https://github.com/B3Partners/brmo/" id="bannerRight"><h2>BRMO</h2>
</a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Meest recente publicatie: 08-februari-2022<span class="divider">|</span>
</li>
          <li id="projectVersion">Versie: 2.2.1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://b3partners.atlassian.net/jira/software/c/projects/BRMO/issues/" class="externalLink" title="Issues dashboard">Issues dashboard</a></li>
      <li class="pull-right"><a href="https://github.com/B3Partners/brmo/wiki" class="externalLink" title="Wiki">Wiki</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Informatie</li>
    <li><a href="index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="https://github.com/B3Partners/brmo/wiki" class="externalLink" title="Wiki"><span class="none"></span>Wiki</a></li>
    <li><a href="https://github.com/B3Partners/brmo/wiki/FAQ-(veel-gestelde-vragen-en-bijzonderheden)" class="externalLink" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="https://github.com/B3Partners/brmo/wiki/Mapping-basisregistraties" class="externalLink" title="Mapping basisregistraties"><span class="none"></span>Mapping basisregistraties</a></li>
    <li class="active"><a href="#"><span class="none"></span>Developer Notes</a></li>
   <li class="nav-header">Handleidingen</li>
    <li><a href="https://github.com/B3Partners/brmo/wiki/Installatiehandleiding" class="externalLink" title="BRMO service installatie"><span class="none"></span>BRMO service installatie</a></li>
    <li><a href="https://github.com/B3Partners/brmo/wiki/BRMO-SOAP-handleiding" class="externalLink" title="BRMO SOAP"><span class="none"></span>BRMO SOAP</a></li>
    <li><a href="https://github.com/B3Partners/brmo/wiki/Handleidingen" class="externalLink" title="Handleidingen"><span class="none"></span>Handleidingen</a></li>
   <li class="nav-header">Modulen</li>
    <li><a href="brmo-test-util/index.html" title="BRMO test-util"><span class="none"></span>BRMO test-util</a></li>
    <li><a href="datamodel/index.html" title="BRMO RSGB datamodel"><span class="none"></span>BRMO RSGB datamodel</a></li>
    <li><a href="brmo-init-util/index.html" title="BRMO initialisatie utilities"><span class="none"></span>BRMO initialisatie utilities</a></li>
    <li><a href="brmo-persistence/index.html" title="BRMO persistence"><span class="none"></span>BRMO persistence</a></li>
    <li><a href="bgt-loader/index.html" title="BRMO BGT / IMGeo CityGML loader"><span class="none"></span>BRMO BGT / IMGeo CityGML loader</a></li>
    <li><a href="bag2-loader/index.html" title="BRMO BAG 2.0 loader"><span class="none"></span>BRMO BAG 2.0 loader</a></li>
    <li><a href="brmo-topnl-loader/index.html" title="BRMO TopNL loader"><span class="none"></span>BRMO TopNL loader</a></li>
    <li><a href="brmo-loader/index.html" title="BRMO loader"><span class="none"></span>BRMO loader</a></li>
    <li><a href="brmo-taglib/index.html" title="BRMO taglibrary"><span class="none"></span>BRMO taglibrary</a></li>
    <li><a href="brmo-service/index.html" title="BRMO service"><span class="none"></span>BRMO service</a></li>
    <li><a href="brmo-proxyservice/index.html" title="BRMO proxyservice"><span class="none"></span>BRMO proxyservice</a></li>
    <li><a href="brmo-soap-util/index.html" title="BRMO SOAP utilities"><span class="none"></span>BRMO SOAP utilities</a></li>
    <li><a href="brmo-soap/index.html" title="BRMO SOAP bevragingsservice"><span class="none"></span>BRMO SOAP bevragingsservice</a></li>
    <li><a href="brmo-stufbg204/index.html" title="BRMO STUF BG 204"><span class="none"></span>BRMO STUF BG 204</a></li>
    <li><a href="brmo-commandline/index.html" title="BRMO commandline"><span class="none"></span>BRMO commandline</a></li>
    <li><a href="brmo-dist/index.html" title="BRMO distributie"><span class="none"></span>BRMO distributie</a></li>
    <li><a href="docker/index.html" title="BRMO Dockerfile"><span class="none"></span>BRMO Dockerfile</a></li>
   <li class="nav-header">Project documentatie</li>
    <li><a href="project-info.html" title="Project informatie"><span class="icon-chevron-right"></span>Project informatie</a></li>
    <li><a href="project-reports.html" title="Project rapporten"><span class="icon-chevron-right"></span>Project rapporten</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Gemaakt door Maven" class="poweredBy"><img class="builtBy" alt="Gemaakt door Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Developer notes</h1><section>
<h2><a name="release_maken"></a>release maken</h2>
<p>Een release bouwen begint met het uitvoeren van het commando <code>mvn clean release:prepare</code>
daarbij wordt voor de verschillende artifacten om versienummers gevraagd (evt. de
optie <code>-DautoVersionSubmodules=true</code> gebruiken als alles dezelfde versie moet krijgen),
zowel voor voor de release als de volgende ontwikkel versie.
Tevens wordt er om een naam voor een tag gevraagd. In principe kan alle informatie op de
commandline worden meegegeven, bijvoorbeeld:</p>

<div class="source"><pre class="prettyprint"><code>mvn release:prepare -l rel-prepare.log -DautoVersionSubmodules=true -DdevelopmentVersion=1.6.1-SNAPSHOT -DreleaseVersion=1.6.0 -Dtag=v1.6.0 -T1
mvn release:perform -l rel-perform.log
</code></pre></div>
<p>Met het commando <code>mvn release:perform</code> wordt daarna, op basis van de tag uit de
stap hierboven, de release gebouwd en gedeployed naar de repository uit de (parent)
pom file. De release bestaat uit jar en war files met daarin oa. ook de javadoc.
Voor het hele project kan dit even duren, oa. omdat de javadoc gebouwd wordt.</p><section>
<h3><a name="Maven_site_bouwen_en_online_brengen"></a>Maven site bouwen en online brengen</h3>
<p>De Maven site voor de BRMO leeft in de <code>gh-pages</code> branch van de repository, met onderstaande commando's kan de site worden bijgwerkt en online gebracht.</p>
<ul>

<li><code>cd target/checkout</code> (als je dit direct na een release doet)</li>
<li><code>mvn -T1 site site:stage</code></li>
<li><code>mvn scm-publish:publish-scm -T1</code></li>
</ul>
<p><i>NB</i> de git acties willen wel eens mislukken omdat de commandline te lang wordt</p></section><section>
<h3><a name="nieuwe_ontwikkel_cyclus"></a>nieuwe ontwikkel cyclus</h3>
<p>Na het maken van de release kun je het script <code>new-version-upgrades.sh</code> in de <code>datamodel/upgrade_scripts</code> directory gebruiken om upgrade scripts voor de volgende release te maken.</p>

<div class="source"><pre class="prettyprint"><code>cd datamodel/upgrade_scripts
./new-version-upgrades.sh
git push
</code></pre></div></section><section>
<h3><a name="git_configuratie"></a>git configuratie</h3>
<p>Op sommige systemen en bij sommige versies van git moet er eea. worden ingesteld voorafgaand aan het starten van de release procedure.</p>

<div class="source"><pre class="prettyprint"><code>git config --add status.displayCommentPrefix true
export LANG=C
mvn clean release:prepare
</code></pre></div></section></section><section>
<h2><a name="Integratie_en_unit_tests"></a>Integratie en unit tests</h2>
<p>Er zijn drie Maven profielen (postgresql, oracle, mssql) voor de ondersteunde databases gedefinieerd,
de profiele zorgen ervoor dat de juist JDBC driver beschikbaar komt in de test suites,
tevens kan daarmee de juiste configuratie worden geladen.</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>unit tests</th>
<th>integratie tests</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">Naamgeving conventie <code>&lt;Mijn&gt;Test.java</code></td>
<td>Naamgeving conventie <code>&lt;Mijn&gt;IntegrationTest.java</code></td></tr>
<tr class="a">
<td align="left">Zelfstandige tests, zonder runtime omgeving benodigdheden, eventueel voorzien van een data bestand, maar zonder verdere afhankelijkheden.</td>
<td>Tests die een database omgeving en/of servlet container nodig hebben.</td></tr>
<tr class="b">
<td align="left">Unit tests worden onafhankelijk van het gebruikte Maven profiel uitgevoerd, in principe tijdens iedere full build, tenzij er een <code>skip</code> optie voor het overslaan van de tests wordt meegegeven.</td>
<td>Unit tests worden afhankelijk van het gebruikte Maven profiel uitgevoerd.</td></tr>
</tbody>
</table>
<p>Het is mogelijk om bepaalde tests uit te sluiten voor een bepaalde omgeving, dat kan mbv. de marker interfaces in de <a href="/brmo/brmo-test-util/index.html"><code>brmo-test-util</code> module</a>.</p>
<p>Bekijk de <code>.github/workflow/</code>, <code>appveyor.yml</code> en <code>Jenkinsfile</code> hoe de integratie tests worden gestart.</p><section>
<h3><a name="database_configuratie"></a>database configuratie</h3>
<p>Voor de verschillende database omgevingen zijn er in bijvoorbeeld de <code>brmo-service</code> module,
de <code>brmo-loader</code> module property files gemaakt met een
configuratie die gebruikt wordt in de verschillende CI omgevingen. Deze bestanden zijn
in de test resources te vinden. Lokaal kun je een override definieren voor een bepaalde
omgeving door een bestand naast het bestaande te zetten met de naam <code>local.&lt;DB smaakje&gt;.properties</code>.</p>
<p>De te gebruiken database smaak wordt middels de <code>database.properties.file</code> property in de pom.xml van de
module of via commandline ingesteld.</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>property file</th>
<th>gebruikt op</th>
<th>override</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">postgres.properties</td>
<td>Github</td>
<td>local.postgres.properties</td></tr>
<tr class="a">
<td align="left">sqlserver.properties</td>
<td>AppVeyor, Github</td>
<td>local.sqlserver.properties</td></tr>
<tr class="b">
<td align="left">oracle.properties</td>
<td>Jenkins</td>
<td>local.oracle.properties</td></tr>
</tbody>
</table>
<p>Voor gebruik van de propertyfile in een integratie test kun je overerven van een
abstracte klasse in verschillende modules.</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>module</th>
<th>klasse</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">brmo-loader</td>
<td><code>nl.b3p.AbstractDatabaseIntegrationTest</code></td></tr>
<tr class="a">
<td align="left">brmo-service</td>
<td><code>nl.b3p.web.TestUtil</code></td></tr>
<tr class="b">
<td align="left">brmo-soap</td>
<td><code>nl.b3p.brmo.soap.db.TestUtil</code></td></tr>
<tr class="a">
<td align="left">brmo-stufbg204</td>
<td><code>nl.b3p.brmo.stufbg204.TestStub</code></td></tr>
</tbody>
</table></section><section>
<h3><a name="servlet_container_configuratie"></a>servlet container configuratie</h3>
<p>Voor de brmo-service module is een voorbeeld beschikbaar in de klasse <code>nl.b3p.web.IndexPageIntegrationTest</code></p></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2014&#x2013;2022
<a href="https://www.b3partners.nl/">B3Partners B.V.</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
