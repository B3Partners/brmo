<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M19 from src/site/markdown/developer-notes.md at 10-Sep-2024
 | Rendered using Apache Maven Fluido Skin 2.0.0-M10
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M19" />
    <title>Ontwikkelaar notities – BRMO 4.0.0-SNAPSHOT</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M10.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M10.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><a href="https://www.b3partners.nl/" class="externalLink"><img class="imageLink" src="images/logo.png" /> B3Partners B.V.</a></h1></div></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="./">BRMO</a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 07-Feb-2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 4.0.0-SNAPSHOT</li>
        <li class="pull-right"><span class="divider">|</span>
<a href="https://b3partners.atlassian.net/jira/software/c/projects/BRMO/issues/" class="externalLink">Issues dashboard</a></li>
        <li class="pull-right"><a href="wiki">Wiki</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Informatie</li>
    <li><a href="index.html">Home</a></li>
    <li><a href="wiki">Wiki</a></li>
    <li><a href="wiki/FAQ-(veel-gestelde-vragen-en-bijzonderheden)">FAQ</a></li>
    <li><a href="wiki/Mapping-basisregistraties">Mapping basisregistraties</a></li>
    <li class="active"><a>Ontwikkelaar notities</a></li>
   <li class="nav-header">Handleidingen</li>
    <li><a href="wiki/Installatiehandleiding">BRMO service installatie</a></li>
    <li><a href="wiki/Handleidingen">Handleidingen</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="brmo-test-util/index.html">BRMO test-util</a></li>
    <li><a href="datamodel/index.html">BRMO RSGB database schema&apos;s</a></li>
    <li><a href="brmo-init-util/index.html">BRMO initialisatie utilities</a></li>
    <li><a href="brmo-persistence/index.html">BRMO persistence</a></li>
    <li><a href="bgt-loader/index.html">BRMO BGT / IMGeo CityGML loader</a></li>
    <li><a href="bag2-loader/index.html">BRMO BAG 2.0 loader</a></li>
    <li><a href="brmo-topnl-loader/index.html">BRMO TopNL loader</a></li>
    <li><a href="brmo-loader/index.html">BRMO loader</a></li>
    <li><a href="brmo-taglib/index.html">BRMO taglibrary</a></li>
    <li><a href="brmo-service/index.html">BRMO service</a></li>
    <li><a href="brmo-proxyservice/index.html">BRMO proxyservice</a></li>
    <li><a href="brmo-soap-util/index.html">BRMO SOAP utilities</a></li>
    <li><a href="brmo-stufbg204/index.html">BRMO STUF BG 204</a></li>
    <li><a href="brmo-commandline/index.html">BRMO commandline</a></li>
    <li><a href="brmo-dist/index.html">BRMO distributie</a></li>
    <li><a href="docker/index.html">BRMO Dockerfile</a></li>
    <li><a href="nhr-loader/index.html">BRMO NHR loader</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<section><a id="Ontwikkelaar_notities"></a>
<h1>Ontwikkelaar notities</h1><section><a id="Bouwen"></a>
<h2>Bouwen</h2><section><a id="Vereisten"></a>
<h3>Vereisten</h3>
<ul>

<li>Java 17</li>
<li>Maven 3.9.5 of hoger</li>
<li>Docker 27.0.x met buildx 0.16.x en compose 2.29.x of hoger (dit vereiste kan worden overgeslagen als je geen
docker images wilt bouwen en/of geen release artifacten wilt bouwen)</li>
<li>Graphviz 2.40.x of hoger (voor het maken van de database documentatie)</li>
</ul></section><section><a id="Basisprocedure"></a>
<h3>Basisprocedure</h3>
<ol style="list-style-type: decimal;">

<li>clone de repository (gebruik bij voorbaat ssh): <code>git clone git@github.com:B3Partners/brmo.git</code></li>
<li>maak een branch voor je wijzigingen, met de ticket in de naam, bijvoorbeeld: <code>git checkout -b BRMO-1234_mijn-wijzigingen</code></li>
<li>doe je ding, als het mogelijk is gebruik <code>google</code> styling (voer <code>mvn fmt:format sortpom:sort</code> uit om alle opmaak te corrigeren)</li>
<li>voer <code>mvn -T1 modernizer:modernizer</code> uit om te controleren of er geen Java 11 of lagere code-constructies worden gebruikt</li>
<li>voer <code>mvn clean install</code> uit om te controleren of alle vereiste opmaak is toegepast en of alle tests slagen</li>
<li>pas de upgrade scripts aan in de <code>datamodel/upgrade_scripts</code> directory voor de versie waarin je wijzigingen komen,
bijvoorbeeld in: <code>upgrade_scripts/3.0.2-4.0.0/postgresql/rsgb.sql</code> voor de upgrade van 3.0.2 naar 4.0.0 vam het rsgb schema in PostgreSQL</li>
<li>commit en push je branch om een pull request te maken, gebruik de <strong>Nederlandse taal</strong> voor commit messages en pull
request beschrijvingen zodat we consistente release notes krijgen. De release notes worden gegenereerd uit de titel van
een pull request. Indien er iets gedaan moet worden (bijvoorbeeld views droppen oid.) bij een upgrade naar de
volgende versie dient de PR deze procedure te beschrijven. Zorg dat de Jira issue is vermeld in de PR titel.</li>
<li>wacht op het doorlopen van de Q&amp;A procedures en volledige CI, pas eventueel je PR aan</li>
<li>wacht op het doorlopen van de code review, pas eventueel je PR aan en merge je PR</li>
<li>update de upgrade instructies op de wiki: <a href="https://github.com/B3Partners/brmo/wiki/Upgrade-Instructies" class="externalLink">https://github.com/B3Partners/brmo/wiki/Upgrade-Instructies</a> voor de nieuwe
versie waarin je wijzigingen komen. Het is handig om (ook) de pull request beschrijving te gebruiken voor de upgrade instructies</li>
</ol></section></section><section><a id="release_maken"></a>
<h2>release maken</h2>
<p>Een release bouwen begint met het uitvoeren van het commando <code>mvn clean release:prepare</code>
daarbij wordt voor de verschillende artifacten om versienummers gevraagd (evt. de
optie <code>-DautoVersionSubmodules=true</code> gebruiken als alles dezelfde versie moet krijgen),
zowel voor voor de release als de volgende ontwikkel versie.
Tevens wordt er om een naam voor een tag gevraagd. In principe kan alle informatie op de
commandline worden meegegeven, bijvoorbeeld:</p>

<pre class="prettyprint"><code class="language-bash">mvn release:prepare -l rel-prepare.log -DautoVersionSubmodules=true -DdevelopmentVersion=4.0.0-SNAPSHOT -DreleaseVersion=4.0.0 -Dtag=v4.0.0 -T1
mvn release:perform -l rel-perform.log -T1
</code></pre>
<p><em>NB</em> Voor het maken van de database documentatie is een draaiende, up-2-date databases met de betreffende RSGB
schema's (public, brk, bag) nodig op <code>jdbc:postgresql://127.0.0.1:5432/rsgb</code>, dat kan met onderstaande commando's:
<em>Zorg dat de tabellen en views zijn aangemaakt (BAG!).</em></p>

<pre class="prettyprint"><code class="language-bash">export POSTGRES_PASSWORD=postgres
export PGPASSWORD=postgres
.build/ci/pgsql-start-docker.sh 16-3.4-alpine
.build/ci/pgsql-create-databases.sh
.build/ci/pgsql-setup.sh
mvn -e verify -B -Ppostgresql -T1 -Dtest.onlyITs=true -pl 'bag2-loader' -DskipQA=true
.build/ci/pgsql-setup-bag2_views.sh
</code></pre>
<p>Met het commando <code>mvn release:perform</code> wordt daarna, op basis van de tag uit de
stap hierboven, de release gebouwd en gedeployed naar de repository uit de (parent)
pom file. De release bestaat uit docker images en jar en war files met daarin oa. ook de javadoc.
Voor het hele project kan dit even duren, oa. omdat de javadoc gebouwd wordt.</p><section><a id="Maven_site_bouwen_en_online_brengen"></a>
<h3>Maven site bouwen en online brengen</h3>
<p>De Maven site voor de BRMO leeft in de <code>gh-pages</code> branch van de repository, met onderstaande commando's kan de site
worden bijgewerkt en online gebracht. De SchemaSpy tool waarmee database schema documentatie wordt gemaakt heeft
Graphviz nodig, installeer met <code>sudo apt install -y --no-install-recommends graphviz</code>.</p>
<ul>

<li><code>cd target/checkout</code> (als je dit direct na een release doet)</li>
<li><code>mvn -T1 site site:stage -DskipQA=true</code></li>
<li><code>mvn scm-publish:publish-scm -T1</code></li>
</ul>
<p><em>NB</em> de git acties willen wel eens mislukken omdat de commandline te lang wordt; je kunt dan met de hand een commit
doen van de staged site in jouw temp directory.</p></section><section><a id="Jira_release_publiceren"></a>
<h3>Jira release publiceren</h3>
<p>Release de gemaakte versie in Jira: <a href="https://b3partners.atlassian.net/projects/BRMO?selectedItem=com.atlassian.jira.jira-projects-plugin%3Arelease-page" class="externalLink">https://b3partners.atlassian.net/projects/BRMO?selectedItem=com.atlassian.jira.jira-projects-plugin%3Arelease-page</a>
en maak evt. de volgende versie aan.</p></section><section><a id="nieuwe_ontwikkel_cyclus"></a>
<h3>nieuwe ontwikkel cyclus</h3>
<p>Na het maken van de release kun je het script <code>new-version-upgrades.sh</code> in de <code>datamodel/upgrade_scripts</code> directory
gebruiken om de initi&#xeb;le upgrade scripts voor de volgende release te maken.</p>

<pre class="prettyprint"><code class="language-bash">cd datamodel/upgrade_scripts
./new-version-upgrades.sh
git push
</code></pre>
<p>Begin met de nieuwe upgrade instructies op de wiki: <a href="https://github.com/B3Partners/brmo/wiki/Upgrade-Instructies" class="externalLink">https://github.com/B3Partners/brmo/wiki/Upgrade-Instructies</a></p></section><section><a id="git_configuratie"></a>
<h3>git configuratie</h3>
<p>Op sommige systemen en bij sommige versies van git moet er eea. worden ingesteld voorafgaand aan het starten van de
release procedure.</p>

<pre class="prettyprint"><code class="language-bash">git config --add status.displayCommentPrefix true
export LANG=C
mvn clean install
</code></pre></section></section><section><a id="Integratie_en_unit_tests"></a>
<h2>Integratie en unit tests</h2>
<p>Er zijn drie Maven profielen (postgresql, oracle) voor de ondersteunde databases gedefinieerd,
de profielen zorgen ervoor dat de juist JDBC driver beschikbaar komt in de test suites,
tevens kan daarmee de juiste configuratie worden geladen.</p>
<table class="table table-striped">
<thead>
<tr class="a">
<th>unit tests</th>
<th>integratie tests</th></tr></thead><tbody>
<tr class="b">
<td>Naamgeving conventie <code>&lt;Mijn&gt;Test.java</code></td>
<td>Naamgeving conventie <code>&lt;Mijn&gt;IntegrationTest.java</code></td></tr>
<tr class="a">
<td>Zelfstandige tests, zonder runtime omgeving benodigdheden, eventueel voorzien van een data bestand, maar zonder verdere afhankelijkheden.</td>
<td>Tests die een database omgeving en/of servlet container nodig hebben.</td></tr>
<tr class="b">
<td>Unit tests worden onafhankelijk van het gebruikte Maven profiel uitgevoerd, in principe tijdens iedere full build, tenzij er een <code>skip</code> optie voor het overslaan van de tests wordt meegegeven.</td>
<td>Unit tests worden afhankelijk van het gebruikte Maven profiel uitgevoerd.</td></tr></tbody>
</table>

<p>Het is mogelijk om bepaalde tests uit te sluiten voor een bepaalde omgeving, dat kan mbv. de marker interfaces in
de <a href="/brmo/brmo-test-util/index.html"><code>brmo-test-util</code> module</a>.</p>
<p>Bekijk onder <code>.github/workflow/</code> hoe de integratie tests worden gestart.</p><section><a id="database_configuratie"></a>
<h3>database configuratie</h3>
<p>Voor de verschillende database omgevingen zijn er in bijvoorbeeld de <code>brmo-service</code> module,
de <code>brmo-loader</code> module property files gemaakt met een
configuratie die gebruikt wordt in de verschillende CI omgevingen. Deze bestanden zijn
in de test resources te vinden. Lokaal kun je een override definieren voor een bepaalde
omgeving door een bestand naast het bestaande te zetten met de naam <code>local.&lt;DB smaakje&gt;.properties</code>.</p>
<p>De te gebruiken database smaak wordt middels de <code>database.properties.file</code> property in de pom.xml van de
module of via commandline ingesteld.</p>
<table class="table table-striped">
<thead>
<tr class="a">
<th>property file</th>
<th>gebruikt op</th>
<th>override</th></tr></thead><tbody>
<tr class="b">
<td>postgres.properties</td>
<td>Github</td>
<td>local.postgres.properties</td></tr>
<tr class="a">
<td>oracle.properties</td>
<td>Github</td>
<td>local.oracle.properties</td></tr></tbody>
</table>

<p>Voor gebruik van de property file in een integratie test kun je overerven van een
abstracte klasse in verschillende modules.</p>
<table class="table table-striped">
<thead>
<tr class="a">
<th>module</th>
<th>klasse</th></tr></thead><tbody>
<tr class="b">
<td>brmo-loader</td>
<td><code>nl.b3p.AbstractDatabaseIntegrationTest</code></td></tr>
<tr class="a">
<td>brmo-service</td>
<td><code>nl.b3p.web.TestUtil</code></td></tr>
<tr class="b">
<td>brmo-stufbg204</td>
<td><code>nl.b3p.brmo.stufbg204.TestStub</code></td></tr></tbody>
</table>
</section><section><a id="servlet_container_configuratie"></a>
<h3>servlet container configuratie</h3>
<p>Voor de brmo-service module is een voorbeeld beschikbaar in de klasse <code>nl.b3p.web.IndexPageIntegrationTest</code></p></section></section></section>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2014–2024
<a href="https://www.b3partners.nl/">B3Partners B.V.</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>