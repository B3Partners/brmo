<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CleanUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">BRMO test-util</a> &gt; <a href="index.source.html" class="el_package">nl.b3p.brmo.test.util.database.dbunit</a> &gt; <span class="el_source">CleanUtil.java</span></div><h1>CleanUtil.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2016 B3Partners B.V.
 */
package nl.b3p.brmo.test.util.database.dbunit;

import java.sql.SQLException;
import org.dbunit.DatabaseUnitException;
import org.dbunit.database.IDatabaseConnection;
import org.dbunit.dataset.DefaultDataSet;
import org.dbunit.dataset.DefaultTable;
import org.dbunit.operation.DatabaseOperation;

/**
 * DBunit utility om databases leeg te maken.
 *
 * @author mprins
 */
public final class CleanUtil {

  /** private by design. */
  private CleanUtil() {}

  /**
   * leegt de BRK tabellen in het RSGB schema. kan worden gebruikt in een {@code @After} van een
   * test case.
   *
   * @param rsgb database welke geleegd moet worden
   * @param deleteBrondocument {@code true} als brondocumenten ook verwijderd moeten worden
   * @throws org.dbunit.DatabaseUnitException als er een DBunit fout optreedt
   * @throws java.sql.SQLException als er iets misgaat in de database
   */
  public static void cleanRSGB_BRK(final IDatabaseConnection rsgb, final boolean deleteBrondocument)
      throws DatabaseUnitException, SQLException {

<span class="nc bnc" id="L35" title="All 2 branches missed.">    if (deleteBrondocument) {</span>
<span class="nc" id="L36">      DatabaseOperation.TRUNCATE_TABLE.execute(</span>
          rsgb, new DefaultDataSet(new DefaultTable[] {new DefaultTable(&quot;brondocument&quot;)}));
    }
    /* cleanup rsgb, doet:
           DELETE FROM herkomst_metadata;
           DELETE FROM zak_recht;
           DELETE FROM ingeschr_niet_nat_prs;
           ...
           DELETE FROM kad_perceel_archief;
           DELETE FROM kad_perceel;
           DELETE FROM kad_onrrnd_zk_archief;
           DELETE FROM kad_onrrnd_zk;
    dus omgekeerde volgorde tov. onderstaande array
    */
<span class="nc" id="L50">    DatabaseOperation.DELETE_ALL.execute(</span>
        rsgb,
        new DefaultDataSet(
            new DefaultTable[] {
              new DefaultTable(&quot;kad_onrrnd_zk&quot;),
              new DefaultTable(&quot;kad_onrrnd_zk_his_rel&quot;),
              new DefaultTable(&quot;kad_onrrnd_zk_aantek&quot;),
              new DefaultTable(&quot;kad_onrrnd_zk_archief&quot;),
              new DefaultTable(&quot;kad_onrrnd_zk_aantek_archief&quot;),
              new DefaultTable(&quot;kad_perceel&quot;),
              new DefaultTable(&quot;kad_perceel_archief&quot;),
              new DefaultTable(&quot;subject&quot;),
              new DefaultTable(&quot;prs&quot;),
              new DefaultTable(&quot;nat_prs&quot;),
              new DefaultTable(&quot;ingeschr_nat_prs&quot;),
              new DefaultTable(&quot;niet_ingezetene&quot;),
              new DefaultTable(&quot;ander_nat_prs&quot;),
              new DefaultTable(&quot;niet_nat_prs&quot;),
              new DefaultTable(&quot;ingeschr_niet_nat_prs&quot;),
              new DefaultTable(&quot;app_re&quot;),
              new DefaultTable(&quot;app_re_archief&quot;),
              new DefaultTable(&quot;zak_recht&quot;),
              new DefaultTable(&quot;zak_recht_archief&quot;),
              new DefaultTable(&quot;zak_recht_aantek&quot;),
              new DefaultTable(&quot;benoemd_obj_kad_onrrnd_zk&quot;),
              new DefaultTable(&quot;herkomst_metadata&quot;),
              // schemaspy geeft de volgende volgorde
              //  new DefaultTable(&quot;subject&quot;),
              //  new DefaultTable(&quot;prs&quot;),
              //  new DefaultTable(&quot;kad_onrrnd_zk&quot;),
              //  new DefaultTable(&quot;kad_perceel&quot;),
              //  new DefaultTable(&quot;niet_nat_prs&quot;),
              //  new DefaultTable(&quot;nat_prs&quot;),
              //  new DefaultTable(&quot;ingeschr_nat_prs&quot;),
              //  new DefaultTable(&quot;app_re&quot;),
              //  new DefaultTable(&quot;zak_recht&quot;),
              //  new DefaultTable(&quot;ander_btnlnds_niet_nat_prs&quot;),
              //  new DefaultTable(&quot;ander_nat_prs&quot;),
              //  new DefaultTable(&quot;benoemd_obj_kad_onrrnd_zk&quot;),
              //  new DefaultTable(&quot;ingeschr_niet_nat_prs&quot;),
              //  new DefaultTable(&quot;kad_onrrnd_zk_his_rel&quot;),
              //  new DefaultTable(&quot;niet_ingezetene&quot;),
              //  new DefaultTable(&quot;app_re_kad_perceel&quot;),
              //  new DefaultTable(&quot;ingezetene&quot;),
              //  new DefaultTable(&quot;kad_onrrnd_zk_aantek&quot;),
              //  new DefaultTable(&quot;kad_onrrnd_zk_kad_onrrnd_zk&quot;),
              //  new DefaultTable(&quot;zak_recht_aantek&quot;),
              //  new DefaultTable(&quot;app_re_archief&quot;),
              //  new DefaultTable(&quot;app_re_kad_perceel_archief&quot;),
              ////  new DefaultTable(&quot;brondocument&quot;),
              //  new DefaultTable(&quot;kad_onrrnd_zk_aantek_archief&quot;),
              //  new DefaultTable(&quot;kad_onrrnd_zk_archief&quot;),
              //  new DefaultTable(&quot;kad_onrrnd_zk_kad_onrr_archief&quot;),
              //  new DefaultTable(&quot;kad_perceel_archief&quot;),
              //  new DefaultTable(&quot;zak_recht_archief&quot;),
            }));
<span class="nc" id="L106">  }</span>

  /**
   * leegt de BRK 2 tabellen in het BRK schema. kan worden gebruikt in een {@code @After} van een
   * test case.
   *
   * @param rsgbbrk database welke geleegd moet worden moeten worden
   * @throws org.dbunit.DatabaseUnitException als er een DBunit fout optreedt
   * @throws java.sql.SQLException als er iets misgaat in de database
   */
  public static void cleanRSGB_BRK2(final IDatabaseConnection rsgbbrk)
      throws DatabaseUnitException, SQLException {

<span class="nc" id="L119">    DatabaseOperation.DELETE_ALL.execute(</span>
        rsgbbrk,
        new DefaultDataSet(
            new DefaultTable[] {
              // TODO mogelijk de volgorde nog aanpassen
              new DefaultTable(&quot;onroerendezaak&quot;),
              new DefaultTable(&quot;nietnatuurlijkpersoon&quot;),
              new DefaultTable(&quot;adres&quot;),
              new DefaultTable(&quot;natuurlijkpersoon&quot;),
              new DefaultTable(&quot;stuk&quot;),
              new DefaultTable(&quot;stukdeel&quot;),
              new DefaultTable(&quot;persoon&quot;),
              new DefaultTable(&quot;recht&quot;),
              new DefaultTable(&quot;publiekrechtelijkebeperking&quot;),
              new DefaultTable(&quot;onroerendezaakbeperking_archief&quot;),
              new DefaultTable(&quot;onroerendezaakfiliatie&quot;),
              new DefaultTable(&quot;recht_isbeperkttot&quot;),
              new DefaultTable(&quot;objectlocatie&quot;),
              new DefaultTable(&quot;onroerendezaakbeperking&quot;),
              new DefaultTable(&quot;recht_aantekeningrecht&quot;),
              new DefaultTable(&quot;recht_archief&quot;),
              new DefaultTable(&quot;recht_isbelastmet&quot;),
              new DefaultTable(&quot;appartementsrecht&quot;),
              new DefaultTable(&quot;appartementsrecht_archief&quot;),
              new DefaultTable(&quot;objectlocatie_archief&quot;),
              new DefaultTable(&quot;onroerendezaak_archief&quot;),
              new DefaultTable(&quot;perceel&quot;),
              new DefaultTable(&quot;perceel_archief&quot;),
              new DefaultTable(&quot;recht_aantekeningrecht_archief&quot;),
              new DefaultTable(&quot;recht_isbelastmet_archief&quot;),
              new DefaultTable(&quot;recht_isbeperkttot_archief&quot;),
            }));
<span class="nc" id="L151">  }</span>

  /**
   * Leeg de subject en onderliggende tabellen die betrokken zijn bij BRP.
   *
   * @param rsgb database welke geleegd moet worden
   * @throws org.dbunit.DatabaseUnitException als er een DBunit fout optreedt
   * @throws java.sql.SQLException als er iets misgaat in de database
   */
  public static void cleanRSGB_BRP(final IDatabaseConnection rsgb)
      throws DatabaseUnitException, SQLException {
<span class="nc" id="L162">    CleanUtil.cleanRSGB_BRP(rsgb, true);</span>
<span class="nc" id="L163">  }</span>

  /**
   * Leeg de subject en onderliggende tabellen die betrokken zijn bij BRP. NB. deze cleanup is niet
   * bijzonder slim, alle (natuurlijke) personen worden verwijderd, dus ook uit brk.
   *
   * @param rsgb database welke geleegd moet worden
   * @param deleteBrondocument {@code true} als brondocumenten ook verwijderd moeten worden
   * @throws org.dbunit.DatabaseUnitException als er een DBunit fout optreedt
   * @throws java.sql.SQLException als er iets misgaat in de database
   */
  public static void cleanRSGB_BRP(final IDatabaseConnection rsgb, final boolean deleteBrondocument)
      throws DatabaseUnitException, SQLException {
<span class="nc bnc" id="L176" title="All 2 branches missed.">    if (deleteBrondocument) {</span>
<span class="nc" id="L177">      DatabaseOperation.DELETE_ALL.execute(</span>
          rsgb, new DefaultDataSet(new DefaultTable[] {new DefaultTable(&quot;brondocument&quot;)}));
    }
    /* cleanup rsgb, doet:

     DELETE FROM herkomst_metadata;
     ...
     DELETE FROM subject;
    dus omgekeerde volgorde tov. onderstaande array
     */
<span class="nc" id="L187">    DatabaseOperation.DELETE_ALL.execute(</span>
        rsgb,
        new DefaultDataSet(
            new DefaultTable[] {
              new DefaultTable(&quot;subject&quot;),
              new DefaultTable(&quot;prs&quot;),
              new DefaultTable(&quot;nat_prs&quot;),
              new DefaultTable(&quot;ingeschr_nat_prs&quot;),
              new DefaultTable(&quot;niet_ingezetene&quot;),
              new DefaultTable(&quot;ander_nat_prs&quot;),
              new DefaultTable(&quot;niet_nat_prs&quot;),
              new DefaultTable(&quot;ingeschr_niet_nat_prs&quot;),
              new DefaultTable(&quot;ouder_kind_rel&quot;),
              new DefaultTable(&quot;huw_ger_partn&quot;),
              new DefaultTable(&quot;herkomst_metadata&quot;)
            }));
<span class="nc" id="L203">  }</span>

  /**
   * leegt de BAG tabellen in het RSGB schema. kan worden gebruikt in een {@code @After} van een
   * test case.
   *
   * @param rsgb database welke geleegd moet worden
   * @param deleteBrondocument {@code true} als brondocumenten ook verwijderd moeten worden
   * @throws org.dbunit.DatabaseUnitException als er een DBunit fout optreedt
   * @throws java.sql.SQLException als er iets misgaat in de database
   */
  public static void cleanRSGB_BAG(final IDatabaseConnection rsgb, final boolean deleteBrondocument)
      throws DatabaseUnitException, SQLException {

<span class="nc bnc" id="L217" title="All 2 branches missed.">    if (deleteBrondocument) {</span>
<span class="nc" id="L218">      DatabaseOperation.DELETE_ALL.execute(</span>
          rsgb, new DefaultDataSet(new DefaultTable[] {new DefaultTable(&quot;brondocument&quot;)}));
    }
    // cleanup doet deletes in omgekeerde volgorde dan in onderstaande array met tabellen
<span class="nc" id="L222">    DatabaseOperation.DELETE_ALL.execute(</span>
        rsgb,
        new DefaultDataSet(
            new DefaultTable[] {
              // TODO volgorde van de tabellen aanpassen aan constraints
              new DefaultTable(&quot;addresseerb_obj_aand&quot;),
              new DefaultTable(&quot;addresseerb_obj_aand_archief&quot;),
              new DefaultTable(&quot;benoemd_obj&quot;),
              new DefaultTable(&quot;benoemd_terrein&quot;),
              new DefaultTable(&quot;benoemd_terrein_archief&quot;),
              new DefaultTable(&quot;benoemd_terrein_benoem_archief&quot;),
              new DefaultTable(&quot;benoemd_terrein_benoemd_terrei&quot;),
              new DefaultTable(&quot;gebouwd_obj&quot;),
              new DefaultTable(&quot;gebouwd_obj_archief&quot;),
              new DefaultTable(&quot;gebouwd_obj_gebruiksdoel&quot;),
              new DefaultTable(&quot;gem_openb_rmte&quot;),
              new DefaultTable(&quot;gem_openb_rmte_archief&quot;),
              new DefaultTable(&quot;ligplaats&quot;),
              new DefaultTable(&quot;ligplaats_archief&quot;),
              new DefaultTable(&quot;ligplaats_nummeraand&quot;),
              new DefaultTable(&quot;ligplaats_nummeraand_archief&quot;),
              new DefaultTable(&quot;nummeraand&quot;),
              new DefaultTable(&quot;nummeraand_archief&quot;),
              new DefaultTable(&quot;openb_rmte&quot;),
              new DefaultTable(&quot;openb_rmte_gem_openb_rmte&quot;),
              new DefaultTable(&quot;openb_rmte_wnplts&quot;),
              new DefaultTable(&quot;overig_bouwwerk&quot;),
              new DefaultTable(&quot;overig_bouwwerk_archief&quot;),
              new DefaultTable(&quot;overig_gebouwd_obj&quot;),
              new DefaultTable(&quot;overig_gebouwd_obj_archief&quot;),
              new DefaultTable(&quot;overig_terrein&quot;),
              new DefaultTable(&quot;overig_terrein_archief&quot;),
              new DefaultTable(&quot;overig_terrein_gebruiksdoel&quot;),
              new DefaultTable(&quot;ovrg_addresseerb_obj_a_archief&quot;),
              new DefaultTable(&quot;ovrg_addresseerb_obj_aand&quot;),
              new DefaultTable(&quot;pand&quot;),
              new DefaultTable(&quot;pand_archief&quot;),
              new DefaultTable(&quot;standplaats&quot;),
              new DefaultTable(&quot;standplaats_archief&quot;),
              new DefaultTable(&quot;standplaats_nummeraand&quot;),
              new DefaultTable(&quot;standplaats_nummeraand_archief&quot;),
              new DefaultTable(&quot;verblijfsobj&quot;),
              new DefaultTable(&quot;verblijfsobj_archief&quot;),
              new DefaultTable(&quot;verblijfsobj_nummeraan_archief&quot;),
              new DefaultTable(&quot;verblijfsobj_nummeraand&quot;),
              new DefaultTable(&quot;verblijfsobj_pand&quot;),
              new DefaultTable(&quot;verblijfsobj_pand_archief&quot;),
              new DefaultTable(&quot;wnplts&quot;),
              new DefaultTable(&quot;wnplts_archief&quot;)
            }));
<span class="nc" id="L272">  }</span>

  /**
   * ruimt personen en kvk tabellen op.
   *
   * @param rsgb database welke opgeruimd moet worden
   * @throws DatabaseUnitException als er een DBunit fout optreedt
   * @throws SQLException als er iets misgaat in de database
   */
  public static void cleanRSGB_NHR(final IDatabaseConnection rsgb)
      throws DatabaseUnitException, SQLException {
<span class="nc" id="L283">    cleanRSGB_NHR(rsgb, true);</span>
<span class="nc" id="L284">  }</span>

  /**
   * ruimt personen en kvk tabellen op (en ook BRP tabellen).
   *
   * @param rsgb database welke opgeruimd moet worden
   * @param deleteBrondocument {@code true} als brondocumenten ook verwijderd
   * @throws DatabaseUnitException als er iets mis gaat met DBunit, bijv verkeerde volgorde van
   *     verwijderen
   * @throws SQLException als er iets mis gaat met uitvieren van de deletes
   */
  public static void cleanRSGB_NHR(final IDatabaseConnection rsgb, final boolean deleteBrondocument)
      throws DatabaseUnitException, SQLException {

<span class="nc" id="L298">    DatabaseOperation.DELETE_ALL.execute(</span>
        rsgb,
        new DefaultDataSet(
            new DefaultTable[] {
              new DefaultTable(&quot;sbi_activiteit&quot;),
              new DefaultTable(&quot;functionaris&quot;),
              new DefaultTable(&quot;ondrnmng&quot;),
              new DefaultTable(&quot;maatschapp_activiteit&quot;),
              new DefaultTable(&quot;vestg&quot;),
              new DefaultTable(&quot;vestg_activiteit&quot;),
              new DefaultTable(&quot;vestg_naam&quot;),
              new DefaultTable(&quot;ander_btnlnds_niet_nat_prs&quot;),
            }));
<span class="nc" id="L311">    cleanRSGB_BRP(rsgb, deleteBrondocument);</span>
<span class="nc" id="L312">  }</span>

  /**
   * ruimt WOZ en subject tabellen op (dus ook BRP tabellen).
   *
   * @param rsgb database welke opgeruimd moet worden
   * @param deleteBrondocument {@code true} als alle brondocumenten ook verwijderd moeten worden
   * @throws DatabaseUnitException als er iets mis gaat met DBunit, bijv verkeerde volgorde van
   *     verwijderen
   * @throws SQLException als er iets mis gaat met uitvieren van de deletes
   */
  public static void cleanRSGB_WOZ(final IDatabaseConnection rsgb, final boolean deleteBrondocument)
      throws DatabaseUnitException, SQLException {

<span class="nc" id="L326">    DatabaseOperation.DELETE_ALL.execute(</span>
        rsgb,
        new DefaultDataSet(
            new DefaultTable[] {
              new DefaultTable(&quot;woz_obj&quot;),
              new DefaultTable(&quot;woz_deelobj&quot;),
              new DefaultTable(&quot;woz_waarde&quot;),
              new DefaultTable(&quot;woz_omvat&quot;),
              new DefaultTable(&quot;woz_belang&quot;),
              new DefaultTable(&quot;woz_deelobj_archief&quot;),
              new DefaultTable(&quot;woz_obj_archief&quot;),
              new DefaultTable(&quot;woz_waarde_archief&quot;),
              new DefaultTable(&quot;locaand_adres&quot;),
              new DefaultTable(&quot;locaand_openb_rmte&quot;),
            }));
    // WOZ bevat ook vestigingen, NHR leegt ook BRP
<span class="nc" id="L342">    cleanRSGB_NHR(rsgb, deleteBrondocument);</span>
<span class="nc" id="L343">  }</span>

  /**
   * leegt de bericht, laadproces en job tabellen en de automatsiche processen in het staging
   * schema. kan worden gebruikt in een {@code @After} van een test case.
   *
   * @param staging database welke geleegd moet worden
   * @param includeProcessen {@code true} als alle automatische processen ook verwijderd moeten
   *     worden
   * @throws org.dbunit.DatabaseUnitException als er een DBunit fout optreedt
   * @throws java.sql.SQLException als er iets misgaat in de database
   */
  public static void cleanSTAGING(final IDatabaseConnection staging, final boolean includeProcessen)
      throws DatabaseUnitException, SQLException {
<span class="nc bnc" id="L357" title="All 2 branches missed.">    if (includeProcessen) {</span>
<span class="nc" id="L358">      DatabaseOperation.DELETE_ALL.execute(</span>
          staging,
          new DefaultDataSet(
              new DefaultTable[] {
                new DefaultTable(&quot;automatisch_proces&quot;),
                new DefaultTable(&quot;automatisch_proces_config&quot;)
              }));
    }
<span class="nc" id="L366">    DatabaseOperation.DELETE_ALL.execute(</span>
        staging,
        new DefaultDataSet(
            new DefaultTable[] {
              new DefaultTable(&quot;laadproces&quot;), new DefaultTable(&quot;bericht&quot;), new DefaultTable(&quot;job&quot;)
            }));
<span class="nc" id="L372">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>